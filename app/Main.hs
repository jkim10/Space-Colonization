module Main where
import Graphics.Gloss
import Graphics.Gloss.Data.Color
import Tree
import Render
import Control.Monad
import System.Environment(getArgs, getProgName)


maxDistance = 70.0
minDistance = 10.0;

simulationLoop :: Int -> Tree -> IO ()
simulationLoop count DONE = putStrLn "Done"
simulationLoop count tree = simulationLoop (count + 1) (nextBranch 1 1 tree)

-- largeTest :: [(Float, Float)]
-- largeTest = [(-39, -120), (87, 18), (110, 180), (65, -124), (173, 210), (-235, 137), (-24, -197), (145, -239), (-229, -123), (176, 86), (-239, -222), (-66, 230), (-75, -200), (109, -205), (206, 28), (-117, 172), (-137, -136), (216, -115), (148, -99), (6, -53), (222, -211), (220, -161), (12, -30), (245, 203), (-175, -150), (218, 243), (45, 76), (-56, -67), (-43, 240), (-61, 140), (-109, 176), (143, -193), (-206, -219), (171, -122), (-3, -119), (-80, 70), (72, -31), (70, 92), (-75, 206), (247, 222), (134, -115), (-24, 129), (-89, -52), (215, -176), (-95, -147), (-75, -135), (154, -174), (-115, 144), (-97, 167), (173, 158), (-2, -102), (-19, 28), (149, 14), (238, -200), (-120, 65), (-180, -93), (195, -169), (8, -48), (-216, -146), (138, 40), (-236, 225), (-237, -173), (161, -230), (153, -101), (-244, -155), (83, 71), (169, -66), (-47, 242), (-165, 2), (-197, 127), (209, -207), (-78, -85), (186, 101), (-72, -250), (113, -159), (77, -173), (-99, -180), (243, -29), (218, -82), (155, 184), (-236, -182), (93, 54), (29, -100), (-25, 78), (172, 227), (10, 142), (17, -100), (182, 220), (73, 135), (132, -107), (55, -25), (-49, 116), (-36, -2), (144, 23), (208, -193), (9, 158), (-70, 249), (-30, -199), (-74, 141), (150, -143), (-164, 248), (-36, 149), (248, 151), (231, 60), (124, 228), (70, -183), (-155, -19), (-244, 94), (-151, -28), (-123, 202), (-110, -180), (-43, 177), (85, 172), (238, 182), (-179, -86), (-231, -28), (193, -236), (-78, -186), (-243, 45), (70, 74), (-86, -195), (-55, -89), (155, 129), (88, 70), (-78, -40), (-123, 216), (116, 104), (132, -103), (-69, -103), (167, 72), (-221, -239), (-209, -65), (35, -189), (225, 115), (190, 137), (-157, 184), (132, 126), (241, -54), (68, 46), (192, -89), (-203, 127), (-80, -12), (-156, -106), (-194, -8), (-122, 138), (56, -100), (-144, -60), (108, -68), (224, -167), (-12, 13), (-86, -25), (-52, -27), (167, 167), (-58, 153), (197, 36), (-28, -130), (-8, -76), (247, -19), (-118, -128), (-215, -36), (-238, 230), (-9, -240), (71, -5), (24, -222), (71, -48), (-77, -43), (212, 169), (-62, -94), (-78, 234), (162, 230), (127, 143), (-38, -20), (34, -169), (211, -75), (106, -53), (-190, -21), (-112, -10), (-158, -141), (-27, -234), (28, -209), (22, -203), (189, -89), (203, 61), (-28, -20), (-191, -208), (-159, 116), (-200, 183), (-58, -91), (46, -16), (33, 160), (213, -202), (-178, 106), (-114, 10), (157, -141), (159, 90), (-128, -37), (-203, 52), (148, 128), (9, 235), (-118, -50), (108, -179), (-170, 33), (-236, -96), (78, -58), (64, -195), (-132, 16), (245, 105), (33, -9), (-75, 91), (-151, 44), (-247, 238), (-102, 191), (51, -54), (-68, 110), (243, 29), (215, 33), (56, 190), (15, 82), (-105, -76), (-173, 91), (-126, 87), (-6, 40), (112, 7), (165, -180), (9, -202), (-185, -189), (-104, -198), (-14, 22), (-169, 141), (141, -209), (-114, -110), (-170, -76), (79, 140), (185, -178), (33, 146), (89, 196), (239, -23), (19, 5), (102, -5), (-73, 135), (171, 145), (205, 28), (-27, 242), (-186, -111), (-31, 71), (-48, -222), (125, -171), (-116, 136), (-69, -173), (-27, -250), (113, 203), (77, 235), (-228, 54), (16, 95), (32, -188), (-185, 115), (-238, -20), (133, 133), (-110, -184), (100, -36), (160, 244), (158, 166), (241, 186), (24, -168), (60, 175), (-37, 236), (148, -116), (-236, 127), (67, -248), (-223, -20), (-19, -221), (96, 104), (-249, -202), (10, 165), (-99, 118), (130, -89), (162, -19), (221, 209), (118, -56), (173, -173), (-122, 98), (121, 115), (-196, -117), (95, 159), (212, 212), (82, -41), (95, 226), (-141, 131), (236, -247), (-193, 143), (208, -107), (-15, 195), (-178, 120), (55, -112), (149, 182), (-198, 224), (126, -85), (89, 208), (33, 204), (106, -99), (-215, 150), (18, -249), (-229, -141), (-223, 6), (40, -203), (-51, -214), (-116, -51), (85, 205), (-56, -30), (-110, -158), (60, -20), (-129, 247), (-133, 63), (-123, -165), (210, -59), (213, 33), (183, 74), (248, 123), (52, -234), (-223, 74), (-155, -11), (-42, 102), (174, 4), (-83, -204), (124, 62), (20, -2), (205, 90), (32, 7), (-218, 226), (237, 188), (74, -10), (209, -55), (-152, 47), (234, 134), (-244, 118), (22, 217), (0, 126), (-5, -73), (-12, -106), (-80, -96), (-205, -87), (-147, -199), (30, -88), (-195, 30), (138, -88), (203, -167), (221, -93), (-185, 7), (170, 143), (-250, -153), (-185, 98), (153, -24), (14, -15), (-172, 71), (46, -136), (72, -196), (-13, -143), (97, -55), (73, 48), (229, -90), (-241, 71), (-79, 9), (-154, -17), (-205, -87), (104, -15), (77, 59), (82, 55), (-89, 97), (179, -170), (225, 154), (-185, 87), (222, 105), (-29, -245), (74, 239), (113, -51), (195, 201), (-63, 62), (247, -89), (149, 128), (212, 7), (-185, -134), (-229, 99), (-46, 97), (72, 61), (111, 231), (-34, 2), (-173, -242), (167, 123), (-144, 33), (-159, -59), (104, -52), (-67, -8), (-116, -203), (241, 151), (219, 95), (51, 175), (-7, -100), (207, -140), (194, 201), (35, 246), (245, -141), (81, -234), (-227, 12), (132, -168), (-48, -175), (-59, 7), (158, -39), (-99, 240), (-41, 84), (-28, -123), (205, 231), (242, -145), (-34, 202), (58, -62), (149, -185), (-132, 37), (93, -30), (76, -80), (127, -84), (222, -106), (-55, 211), (52, 118), (170, -144), (193, -69), (-79, 67), (233, 180), (122, -249), (-169, 82), (166, 78), (-248, -217), (143, -137), (-205, -246), (-163, 105), (-215, 190), (55, -44), (-40, 88), (74, -163), (35, 38), (-28, -136), (-214, -15), (-97, -134), (-233, 160), (104, -54), (-184, -85), (90, -215), (241, 216), (-62, -177), (-135, 166), (177, 163), (73, -170), (-161, -123), (230, 116), (-204, 180), (-26, -150), (35, 201), (219, -91), (-60, -174), (9, -107), (183, 189), (16, 43), (157, 1), (-162, 123), (58, 117), (-173, 94), (10, 133), (223, -19), (-3, 149), (-104, 62), (-51, 132), (-230, -206), (249, -19), (245, 164), (221, -116), (-188, -232), (9, -191), (52, 36), (145, 215), (61, 63), (-240, -50), (-5, 57), (227, -188), (201, 213), (-39, 198), (202, -145), (-36, -13), (-188, -36), (88, -173), (-118, -74), (-110, -243), (95, -63), (-15, 108), (-102, 162), (-101, -128), (-34, -197), (-68, 80), (-114, -198), (71, -139), (20, 8), (231, 106), (-102, -250), (17, -198), (-86, -190), (-45, 47), (140, -163), (-24, 212), (98, 244), (-117, 226), (-82, -245), (218, -41), (203, 191), (-50, -136), (225, -221), (81, 118), (-50, -4), (-176, 226), (-58, 159), (155, 138), (-211, 46), (203, 93), (-126, -198), (-15, 110), (42, 104), (-114, 93), (-214, 156), (34, 104), (-41, 99), (-139, 90), (25, 166), (142, -179), (-213, 29), (106, 159), (-28, 247), (-232, 52), (-74, -99), (80, 225), (39, 33), (-138, 210), (194, -115), (-241, -35), (46, 183), (132, 160), (210, 174), (-250, -193), (-78, -250), (86, 38), (229, 206), (11, -95), (-127, 146), (-27, 185), (70, 219), (87, -41), (183, 153), (104, -14), (139, 14), (-194, -168), (80, -184), (-62, 161), (25, 124), (-179, 54), (215, -11), (187, -78), (48, -214), (181, 123), (188, -54), (-202, 171), (-97, -211), (212, 145), (-21, -153), (153, -197), (-153, 222), (-236, -192), (229, -103), (111, -150), (-97, -85), (-97, 190), (-15, 208), (213, -216), (169, -222), (190, 49), (107, 205), (213, -159), (150, 248), (107, -100), (200, -117), (74, 248), (-150, 159), (-223, 154), (159, -113), (-243, 19), (100, -194), (221, -164), (242, 134), (-81, -151), (-242, -136), (-23, -160), (-144, 26), (206, -239), (14, -238), (-63, 95), (-64, -61), (115, -206), (129, -211), (-16, -28), (198, -225), (53, 51), (-231, -152), (-45, 22), (-54, 238), (-242, 25), (42, 40), (24, 1), (-83, -78), (170, -73), (-173, 92), (-137, -17), (-142, -39), (25, 127), (174, -123), (-238, -115), (-33, -158), (-210, 167), (-51, -91), (-162, 142), (-138, 53), (-150, -34), (-180, 200), (119, 196), (-108, -212), (-36, -178), (-169, 96), (-245, -128), (137, 25), (-195, 44), (-60, 118), (146, 53), (188, -113), (90, 83), (3, 199), (203, -82), (159, 94), (-103, 212), (-109, -227), (42, 119), (186, 7), (-84, -137), (188, 233), (130, -160), (85, 142), (231, 197), (155, 234), (100, 61), (154, 159), (140, -149), (-167, -76), (-216, -111), (-184, -183), (-206, -174), (249, -55), (-116, -171), (29, -243), (31, 219), (-68, -104), (-73, 249), (152, 9), (2, -188), (48, 144), (-5, -128), (128, 50), (54, 129), (-12, -22), (-135, 55), (-126, -123), (-59, 112), (-185, -245), (-210, 229), (54, -189), (-188, -156), (-112, -131), (-42, 156), (-186, 110), (-190, 65), (-160, -97), (-24, 159), (-186, -220), (-213, -207), (112, -30), (248, -82), (238, -191), (77, -50), (-83, -53), (168, 56), (183, 69), (135, 118), (-61, -127), (-138, -14), (-9, 51), (-103, -123), (-230, -115), (110, -57), (50, -236), (134, 200), (-235, 188), (195, -215), (97, -125), (199, -59), (-246, 85), (-149, 189), (86, -11), (-244, -53), (-76, 183), (-247, -156), (-191, 225), (229, -198), (219, -201), (131, -52), (118, 218), (11, -243), (172, 229), (-245, -111), (188, 249), (59, -164), (11, -186), (-206, -205), (105, -70), (67, -192), (-73, -200), (199, -18), (68, -164), (-2, 207), (62, 216), (-235, 55), (96, -133), (-213, -32), (205, 196), (131, -142), (121, 81), (-118, 11), (-67, 237), (-190, -92), (230, -17), (52, -154), (-188, -134), (-146, 44), (47, 57), (-221, 31), (-209, -189), (-62, -52), (81, 247), (108, 80), (208, 244), (-101, 72), (59, -115), (-226, -190), (142, 210), (248, -25), (-222, 210), (-6, 29), (-233, 32), (-51, 228), (-191, 208), (-81, -183), (231, -44), (68, -156), (-68, 118), (95, -94), (-25, 73), (56, 234), (166, 177), (125, -208), (-5, -238), (-185, -80), (99, -11), (229, 61), (-218, 159), (171, -48), (84, 116), (-9, 174), (-188, 138), (-143, 219), (245, 30), (70, -5), (-238, 182), (-134, -177), (-174, -26), (246, -234), (58, 103), (-137, 50), (45, 39), (-165, -179), (-250, -105), (-125, 123), (-241, -105), (-169, -216), (27, -240), (-58, -218), (181, 60), (54, -54), (213, 27), (131, -65), (-31, -20), (-41, 62), (194, -78), (-231, -202), (101, -7), (-116, 106), (166, 180), (-51, 247), (217, -175), (133, -4), (170, 194), (186, 87), (16, -122), (23, 123), (-191, -108), (233, -79), (-197, 23), (132, -13), (4, 108), (23, 100), (-186, 34), (115, 63), (-96, 245), (36, 167), (-187, 154), (-211, -97), (150, 121), (15, -20), (-227, 204), (25, -211), (-42, -137), (-110, -45), (130, 164), (241, -156), (-99, -75), (-42, 240), (-225, 217), (213, 192), (118, 95), (-151, 242), (-51, 3), (171, 194), (156, -22), (-168, 46), (-20, -225), (228, -191), (-238, 124), (-48, 199), (-97, 179), (135, 118), (-70, 28), (-147, 218), (-85, -226), (144, -246), (31, 217), (131, 224), (-198, -69), (192, 10), (-203, -168), (105, 0), (-39, 156), (153, 101), (-149, 5), (-168, 82), (-249, 108), (113, -87), (159, -244), (67, -28), (-164, -20), (233, 179), (151, 111), (-130, -49), (-12, 40), (169, -204), (-213, 103), (221, -246), (-165, -76), (-159, -133), (16, 123), (-51, 177), (-249, 141), (203, 7), (-51, -242), (-82, 173), (51, -213), (30, 208), (77, 57), (135, 156), (183, 181), (118, 182), (11, 105), (-4, 131), (-16, 223), (-122, 185), (-237, 235), (138, 98), (227, 181), (-181, -31), (-235, 243), (-22, 138), (149, -114), (-35, 98), (-104, 132), (-190, -80), (116, -214), (-167, 196), (70, 235), (63, 1), (-8, -18), (-140, 82), (204, 192), (-108, -67), (-155, -110), (-21, 155), (174, -71), (96, -27), (236, -132), (30, 206), (-177, 80), (84, -69), (-113, -15), (-81, 228), (4, -190), (119, -150), (-199, 152), (-39, 200), (114, -34), (2, -66), (84, 207), (-109, 230), (22, -98), (-38, -53), (151, 153), (-96, 147), (-234, -211), (-22, -177), (-203, -120), (-137, -178), (-238, -131), (112, 74), (20, 93), (-170, 193), (-13, 120), (-103, -83), (66, 13), (161, 33), (-1, 13), (209, -219), (-37, 50), (-121, -226), (-247, -141), (-28, -3), (-94, 159), (-28, -250), (242, -194), (-100, -127), (165, -162), (98, -66), (-39, 249), (-174, 63), (-190, -2), (34, 207), (85, -65), (161, -122), (-84, 205), (-110, 75), (184, 43), (36, 2), (-241, 220), (-100, 0), (81, -141), (18, 34), (-32, 199), (2, 175), (-103, -26), (126, 206), (1, -48), (-221, 204), (169, 221), (-98, 116), (-187, -250), (194, -229), (224, -77), (-20, -197), (85, -19), (-148, 159), (-96, 89), (-212, 216), (-246, 175), (173, -214), (-33, -241), (19, -236), (-72, -9), (-86, -16), (200, -176), (81, -244), (-204, 7), (-149, 91), (-249, -209), (230, 244), (-14, 100)]
testPoints :: [(Float, Float)]
testPoints = [(93, 133), (51, 8), (-41, -62), (-38, -35), (-184, 181), (45, 65), (200, -27), (-220, -75), (5, 213), (-213, -44), (74, -15), (-25, 45), (-31, -21), (128, 218), (-195, 165), (-11, -32), (22, 156), (-234, 54), (-67, 32), (105, 146), (126, 130), (175, 224), (155, 153), (-79, 179), (150, 52), (84, -60), (-223, 209), (121, 76), (53, 135), (-55, 40), (3, -20), (-155, 44), (-243, 168), (-246, -66), (169, 22), (-238, 64), (162, 128), (-180, 186), (-190, 193), (-79, 99), (60, -21), (-250, -79), (221, 18), (-155, 36), (-16, -10), (-220, -76), (-32, 67), (2, -39), (-213, 124), (224, 100), (196, -82), (150, -95), (73, -87), (-177, 183), (218, 200), (125, 22), (-119, 29), (23, -52), (200, 203), (-241, 98), (86, 142), (-151, 103), (-129, 55), (182, 13), (205, 97), (-188, 166), (187, 183), (-62, 24), (-95, -18), (-40, 111), (27, 140), (-45, -56), (-5, 195), (-177, 126), (-17, 67), (166, 175), (-73, 39), (-117, 209), (-43, -49), (-92, 145), (-138, -45), (-99, 97), (91, 163), (-50, 7), (-109, 65), (-101, 23), (15, -85), (-111, 208), (-103, 195), (35, 76), (10, 194), (-27, 43), (192, 161), (156, 220), (208, 170), (-46, 124), (215, -75), (189, -52), (133, 217), (-156, 153), (-237, 31), (-149, 67), (-136, -100), (-182, 10), (181, -38), (-203, -57), (81, 67), (-97, -46), (-93, 92), (-172, -96), (-3, 208), (170, -15), (-154, 45), (-173, 158), (-75, -93), (-89, -56), (126, 94), (-137, -29), (-18, 87), (9, 214), (-58, -17), (62, -16), (60, -37), (-55, 213), (-59, -83), (51, 60), (-243, 205), (-219, 161), (83, 84), (-9, 108), (-231, 220), (-161, 131), (-187, 203), (-215, 112), (-181, 122), (79, -71), (-151, 69), (-56, -83), (101, 185), (121, 194), (199, 5), (91, 143), (-90, -44), (34, 199), (-102, 8), (-85, -9), (63, -22), (-63, 169), (35, 188), (137, 51), (-169, 25), (-15, -18), (195, 140), (106, -35), (-233, 180), (-126, 139), (-186, 146), (-80, 30), (-52, -18), (119, 207), (27, 57), (-122, 100), (102, -74), (-250, 42), (12, 3), (139, 184), (-215, -34), (112, 129), (-40, 43), (-68, -49), (-193, -7), (5, 144), (31, 76), (-115, 30), (164, 141), (-35, -31), (218, 76), (8, -92), (206, 19), (-163, 116), (-185, 90), (-225, 42), (102, -47), (223, -16), (-135, -90), (216, 28), (17, -44), (212, 117), (-66, 80), (-152, -70), (-8, 22), (135, -52), (-54, 217), (82, 186), (-40, 94), (-201, -17), (-24, -92), (-173, -63), (-117, 207), (22, 206)]

window :: Display
window = InWindow "Tree" (500, 500) (0, 0)

backgroundColor :: Color
backgroundColor = makeColor 255 255 255 255

startTree :: Tree
startTree = initialTree testPoints 500 maxDistance minDistance


main :: IO ()
main = do args <- getArgs
          case args of
              [_] -> simulate window backgroundColor 100 startTree treeAsPicture nextBranch
              _ -> simulationLoop 0 startTree
